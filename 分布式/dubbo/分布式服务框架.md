# 分布式服务框架Dubbo

## Dubbo原理

[分布式服务框架](Dubbo.md)

## Dubbo支持哪些序列化协议

1. Dubbo支持哪些通信协议
    - dubbo://协议
        - 默认协议，单一长连接，进行的NIO异步通信，基于hessian作为序列化协议
        - 特性，传输数据量小(每次100k以下)；并发量高，适用多个消费者的情况
    - rmi://协议
        - 采用JDK标准的Java.rmi.*实现
        - 特性，多个短链接，适合消费者和提供者差不多的情况，**适用文件传输**
    - hessian://协议
        - http通信，采用servlet暴露服务，基于hessian序列化协议
        - 多个短链接，适用于提供者数量多的情况，**适用文件传输**
    - http://协议
        - 基于http表单的远程通用协议，走单表序列化
    - thrift://协议
        - 在原生协议的基础上添加了一些额外的头信息，如service name，magic number等
    - webservice://协议
        - 基于apache cxf的fronted-simple和transports-http实现，SOA文本序列化
    - memcached://协议
        - RPC协议
    - redis://协议
        - RPC协议
    - rest://协议
        - 实现REST调用支持
    - grpc://协议
        - 适用HTTP/2通信，想利用Stream、反压、Reactive变成能力的开发者适用
2. 支持的序列化协议

支持hessian，java二进制序列化，SOAP文本序列化，json多种序列化协议

## Dubbo的负载均衡策略和集群容错策略

4中负载均衡策略，6种集群容错策略

### Dubbo的负载均衡策略

1. **RandomLoadBalance，默认策略，随机调用；可以对provider设置不同的权重，按照权重来负载均衡。**

   算法思想：假设有一组服务器servers=[A,B,C],对应权重为weights=[5,3,2],总和为10.把权重平铺在一纬坐标值上，则[0,5]服务器A,[5,8]服务器B,[8,10]
   属于服务器C.随机数生成器生成一个范围在[0,10]之间的随机数，然后计算会落在哪个区间的服务器，坐标轴上区间范围大的，随机数生成的数字就有更大概率落到此区间

2. **RoundRobinLoadBalance，均匀分发**

   算法思想：均匀地将流量打到各个机器上，但是如果各个机器性能不同，容易导致性能差的机器负载过高。所以需要调整权重，让性能差的机器承载权重小一些，流量少一些
3. **LeastActiveLoadBalance，最小活跃数负载均衡，活跃调用数越小，表明该服务提供者效率越高，单位时间内可处理更多请求，此时请求会优先分配给该服务提供者**

   算法思想：每个provider对应一个活跃数active。初识情况，provider的active均为0.每收到一个请求，对应的provider的active会加1，处理完请求后，active会减1.所以，如果provider性能好，处理请求的效率就越高，active下降的越快。也引入了权重值，所以此算法是基于加权最小活跃数算法实现
4. **ConsistenHashLoadBalance，一致性hash**

   算法思想：一致性Hash算法，相同参数请求一定分发到一个provider去。如果需要的不是随机负载均衡策略，要一类请求都到一个节点，那就走一致性Hash策略

### 集群容错策略

1. **Failover Cluster模式**，默认这个，失败自动切换，自动重试其它机器，常见于读操作
2. **Failfast Cluster模式**，一次调用失败就立即失败，常见幂等性的写操作，如新增一条记录
3. **Failsafe Cluster模式**，出现异常时忽略，用于不重要的接口调用，如记录日志
4. **Failback Cluster模式**，失败了后台自动记录请求，然后定时重发，适合写消息队列失败
5.

## Dubbo的SPI思想

## 基于Dubbo的服务治理

## 分布式服务的幂等性如何设计

## 分布式服务接口请求顺序如何保证

## 自己设计一个类似Dubbo的RPC框架

## CAP理论

## 分布式事务

## 基于Hystrix实现高可用